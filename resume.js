/**
 * Resume
 *
 * Copyright Jack Farley 2016
 */
var resume = {
  "profile": "A web application engineer with software in the brain and 8+ years experience in developing web applications. Specialised in proactive problem solving, and coding elegant, responsive web applications for data-rich environments. Looking to contribute towards the understanding of the environment by using engineering knowledge and skills to help explore and present new science.",
  "favouredTech": [ "Javascript", "Node.js", "HTML 5", "Ava", "TravisCI", "Git", "Vim", "Linux", "PlotlyJS" ],
  "positions": [
    {
      "company": {
        "name": "Reef Doctor",
        "href": "http://www.reefdoctor.org"
      },
      "isCurrent": true,
      "location": {
        "country": {
          "code": "mg",
          "name": "Madagascar"
        },
        "name": "Ifaty, Madagascar"
      },
      "startDate": {
        "month": 06,
        "year": 2017
      },
      "endDate": {
        "month": 12,
        "year": 2017
      },
      "description": [
        "Developed a database and web application for storing and analysing Reef Doctor data",
        "Created scripts to clean, correlate and import fisheries catch and effort data into the central database",
        "Redesigned the local network to include file shares, web server and database on a central computer",
        "Carried out maintenance on dive equipment, including replacing batteries in dive computers and assisting in cylinder maintenance and inspections",
        "Qualified as a Padi Divemaster"
      ],
      "title": "Scientific Research Assistant and Divemaster Intern",
      "technologies": [ "React", "Redux", "MongoDB", "HTML5", "Javascript",
          "CSS", "Node.js", "C", "Git" ]
    },
    {
      "company": {
        "name": "Scoota",
        "href": "http://www.scoota.com"
      },
      "isCurrent": true,
      "location": {
        "country": {
          "code": "gb",
          "name": "United Kingdom"
        },
        "name": "London, United Kingdom"
      },
      "startDate": {
        "month": 12,
        "year": 2016
      },
      "endDate": {
        "month": 06,
        "year": 2017
      },
      "description": [
        "Developed their new ad management platform using Angular",
        "Implemented a new look for their Ad creatives editor using AngularJS",
        "Developed ad formats publishing using Amazon Lambda, triggered by Amazon SNS",
        "Contributed towards the ongoing development of their Django backend"
      ],
      "title": "Javascript Software Developer",
      "technologies": [ "HTML5", "Javascript", "CSS", "Node.js",
          "Amazon Lambda", "Amazon SNS", "Jenkins", "Angular", "AngularJS",
          "Mocha", "Python", "Django", "JSONRPC", "Git", "NPM", "Jira" ]
    },
    {
      "company": {
        "id": 10077470,
        "name": "NHS Wales Informatics Service",
        "href": "http://www.wales.nhs.uk/nwis/"
      },
      "id": 747076814,
      "isCurrent": true,
      "location": {
        "country": {
          "code": "gb",
          "name": "United Kingdom"
        },
        "name": "Cardiff, United Kingdom"
      },
      "startDate": {
        "month": 12,
        "year": 2015
      },
      "endDate": {
        "month": 12,
        "year": 2016
      },
      "description": [
        "Developed electronic forms using Orbeon Forms (XForms, XSLT, XML), HTML, CSS, Javascript, Java and Node.js",
        "Lead the development of some forms and mentored other members of the team during development",
        "Championed the use of the Git versioning system and TFS within the team",
        "Lead efficient agile development by designing for code reuse"
      ],
      "title": "Senior Software Developer",
      "technologies": [ "HTML5", "Javascript", "CSS", "Node.js",
          "Orbeon Forms",  "XForms", "XSLT", "XML", "Git", "TFS", "TFVC", "Gulp" ]
    },
    {
      "startDate": {
        "month": 4,
        "year": 2014
      },
      "endDate": {
        "month": 11,
        "year": 2015
      },
      "description": "Overseas Experience (OE) travelling in South and North America"
    },
    {
      "company": {
        "name": "New Zealand Government",
        "href": "https://www.govt.nz/"
      },
      "endDate": {
        "month": 4,
        "year": 2014
      },
      "id": 729440249,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "month": 9,
        "year": 2010
      },
      "description": [
        "Improved the capability of teams by researching and developing complex computer systems to meet stringent requirements and specifications.",
        "Increased the efficiency and resilience to services by developing programs and scripts in Perl, Bash and C to process data and monitor processing systems.",
        "Contributed to web applications for monitoring of processes and systems.",
        "Designed, documented and implemented Linux-heavy networks.",
        "Decreased deployment times by designing and implementing automated Linux operating system (OS) building and virtualisation using kernel virtual machine (KVM).",
        "Increased the security of internal computer networks using OS hardening and, network and firewall design.",
        "Knowledge expert on a number of data processing systems and virtual machine infrastructure.",
        "Mentored and taught colleagues on computer systems and the Linux OS."
        //"Purchased required hardware through internal procurement system dealing directly with suppliers."
      ],
      "title": "Computer Systems Engineer",
      "technologies": [ "Linux", "Perl", "VMware", "Cisco Networking Equipment", "HTML", "Javascript" ]
    },
    {
      "company": {
        "name": "New Zealand Government",
        "href": "https://www.govt.nz/"
      },
      "endDate": {
        "month": 9,
        "year": 2010
      },
      "id": 729438306,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "month": 1,
        "year": 2010
      },
      "description": [
        "Designed and implemented a Perl-based web interface for managing customer job requests.",
        "Administered three computer networks of around 50 computers total, which included workstations and high availability servers.",
        "Managed network and virtual infrastructures.",
        "Implemented network monitoring through Nagios, SAN storage, Puppet configuration management and server viritualisation using VMware ESX and vSphere."
      ],
      "title": "Computer Systems Administrator",
      "technologies": [ "Linux (Red Hat compatible)", "Perl", "VMware",
          "Cisco Networking Equipment", "EMC SANs", "Puppet", "HTML", "CSS",
          "Javascript" ]
    },
    {
      "company": {
        "name": "New Zealand Government",
        "href": "https://www.govt.nz/"
      },
      "endDate": {
        "month": 1,
        "year": 2010
      },
      "id": 734997919,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "month": 7,
        "year": 2008
      },
      "description": [
        "Designed scripts in Perl and C for automated processing of data."
      ],
      "title": "Software Developer",
      "technologies": [ "Perl", "C", "Bash", "Linux" ]
    },
    {
      "company": {
        "name": "Solarhomes"
      },
      "endDate": {
        "month": 6,
        "year": 2008
      },
      "id": 712630753,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "month": 12,
        "year": 2007
      },
      "description": [
        "Designed automated home ventilation systems.",
        "Reverse-engineered and programmed Microchip PIC based automation controllers, and programmed Omron PLC controllers."
      ],
      "title": "Design Engineer",
      "technologies": [ "Omron PLCs", "C", "PIC microcontrollers" ]
    },
    {
      "company": {
        "name": "Freelance",
      },
      "endDate": {
        "year": 2008
      },
      "id": 380174126,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "year": 2004
      },
      "description": [
        "Designed and developed web applications using HTML, CSS, Javascript, PHP, MySQL and Actionscript for multiple clients.",
        "Interacted with customers during entire development life cycle."
      ],
      "title": "Web Application Engineer",
      "technologies": [ "HTML", "Javascript", "CSS", "PHP", "MySQL",
          "ActionScript"]
    },
    {
      "company": {
        "id": 77529,
        "industry": "Telecommunications",
        "name": "Tait Communications",
        "size": "501-1000",
        "type": "Privately Held",
        "href": "https://www.taitradio.com/"
      },
      "endDate": {
        "month": 2,
        "year": 2007
      },
      "id": 712632746,
      "isCurrent": false,
      "location": {
        "name": "Christchurch, New Zealand"
      },
      "startDate": {
        "month": 11,
        "year": 2006
      },
      "description": [
        "Developed a radio log analyser and web-interface using Python and SQLite to detect and investigate inconsistencies in radio products."
      ],
      "title": "Junior Design Engineer (Summer Internship)",
      "technologies": [ "Python", "Javascript", "HTML", "Javascript", "CSS", "SQLite" ]
    },
    {
      "company": {
        "name": "BrowserCRM"
      },
      "endDate": {
        "month": 2,
        "year": 2006
      },
      "id": 712635239,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "month": 11,
        "year": 2005
      },
      "description": [
        "Developed client-side (Javascript, CSS and HTML) and server-side (PHP and MySQL) parts of the BrowserCRM interface"
      ],
      "title": "Developer",
      "technologies": [ "Javascript", "HTML", "CSS", "PHP", "MySQL" ]
    }
  ],
  "education": [
    {
      "className": "noprint",
      "course": {
        "name": "Meetup",
        "href": "hthttp://www.meetup.com/members/195339544/"
      },
      "school": [
        {
          "name": "UX Playground",
          "href": "http://www.meetup.com/UX-Playground-The-User-Experience-Meetup-for-Londoners/"
        },
        {
          "name": "BCS South Wales",
          "href": "http://www.meetup.com/BCS-South-Wales/"
        },
        {
          "name": "Test and QA Wales",
          "href": "http://www.meetup.com/Cardiff-Software-Testers-Meetup/"
        },
        /*{
          "name": "",
          "href": ""
        },*/
      ],
      "startDate": {
        "month": 11,
        "year": 2015
      }
    },
    {
      "school": {
        "name": "MongoDB University",
        "href": "https://university.mongodb.com"
      },
      "course": [
        {
          "name": "MongoDB for Node.js Developers",
          "code": "M101JS",
          "href": "https://university.mongodb.com/courses/M101JS/about"
        },
        {
          "name": "MongoDB for DBAs",
          "code": "M102",
          "href": "https://university.mongodb.com/courses/M102/about"
        }
      ],
      "date": {
        "month": 2,
        "year": 2015
      },
      "keywords": ["MongoDB", "NoSQL", "Javascript", "Database Administration"]
    },
    {
      "className": "noprint",
      "school": {
        "name": "Wellington Institute of Technology",
        "href": "http://www.weltec.ac.nz"
      },
      "location": {
        "name": "Wellington, NZ",
        "city": "Wellington",
        "country": "nz"
      },
      "date": {
        "month": 4,
        "year": 2014
      },
      "course": {
        "name": "Electrical Trade Revision Course",
        "href": "https://www.weltec.ac.nz/SUBJECTAREAS/EngineeringTrades/ElectricalTradeRevisionCourse/tabid/442/Default.aspx"
      },
      "certification": {
        "name": "Electrical Workers Registration Board (EWRB) Electrical Engineer Registration",
        "href": "http://www.ewrb.govt.nz/training-and-qualifications/requirements-by-class/electrical-engineers/"
      },
      "keywords": ["Electrical Engineer", "Electronics", "Electrical"]
    },
    {
      "school": {
        "name": "Auldhouse",
        "href": "http://www.auldhouse.co.nz"
      },
      "location": {
        "name": "Wellington, NZ"
      },
      "date": {
        "month": 11,
        "year": 2009
      },
      "certification": {
        "name": "Redhat Enterprise Linux (RHEL) Certified Engineer"
      }
    },
    {
      "school": {
        "name": "University of Canterybury",
        "href": "http://www.canterbury.ac.nz"
      },
      "location": {
        "name": "Christchurch, NZ",
        "city": "Christchurch",
        "country": "nz"
      },
      "certification": {
        "name": "Bachelor of Engineering with Honours",
        "specialisation": "Electrical and Electronic Engineering"
      },
      "startDate": {
        "month": 2,
        "year": 2004
      },
      "endDate": {
        "month": 11,
        "year": 2007
      },
      "description": {
        "elements": [
          "Specialising in:",
          [
            "Computer Hardware",
            "Computer Software",
            "Communications",
            "Electronic Materials & Device Engineering",
            "Engineering Management"
          ]
        ]
      }
    },
    {
      "className": "noprint",
      "school": {
        "name": "Onslow College",
        "href": "http://www.onslow.school.nz"
      },
      "location": {
        "name": "Wellington, NZ",
        "city": "Wellington",
        "country": "nz"
      },
      "certification": [
        {
          "name": "Bursary",
          "grade": "A Bursary",
          "href": "http://www.nzqa.govt.nz/qualifications-standards/results-2/secondary-school-qualifications-prior-to-2002/"
        },
        {
          "name": "Sixth Form Certificate",
          "grade": "University Entrance",
          "href": "http://www.nzqa.govt.nz/qualifications-standards/results-2/secondary-school-qualifications-prior-to-2002/"
        },
        {
          "name": "Electroics Technology Level 2",
        }
      ],
      "startDate": {
        "month": 2,
        "year": 1999
      },
      "endDate": {
        "month": 11,
        "year": 2003
      }
    }
  ],
  "memberships": [
    {
      "organisation": {
        "name": "British Computer Society (BCS)",
        "href": "http://www.bcs.org.uk"
      },
      "startDate": {
        "year": 2016
      }
    },
    {
      "organisation": {
        "name": "Institute of Electrical and Electronic Engineers (IEEE)",
        "href": "http://www.ieee.org"
      },
      "startDate": {
        "year": 2004
      }
    },
    {
      "organisation": {
        "name": "Institute of Engineering and Technology (IET)",
        "href": "http://www.iet.org"
      },
      "startDate": {
        "year": 2004
      }
    }
  ],
  "interests": [
    'Technology',
    'Computers',
    {
      "name": "Podcasts",
      "description": [
        {
          "name": "Software Engineering Daily",
          "href": "http://softwareengineeringdaily.com/category/podcast/",
        },
        {
          "name": "The Web Ahead",
          "href": "http://www.thewebahead.net",
        },
        {
          "name": "Risky Biz",
          "href": "https://www.risky.biz",
        },
        {
          "name": "Quirks and Quarks",
          "href": "http://cbc.ca/quirks"
        },
        {
          "name": "Living on Earth",
          "href": "http://loe.org"
        }
      ]
    },
    'Hiking',
    'Scuba Diving',
    'The Outdoors'
  ]
};

var main;
var search;
var sections = [];
var current;

function createElement(type) {
  if (typeof type === 'undefined') {
    type = 'p';
  } else if (typeof type !== 'string') {
    throw new Error('type must be a string');
  }

  var dom, el;

  var args = Array.from(arguments);
  args.shift();
  var length = args.length;

  if (!length) {
    return document.createElement(type);
  } else if (length === 1) {
    if (args[0] instanceof Array) {
      args = args[0];
      length = args.length;
    } else if (args[0] instanceof HTMLElement) {
      dom = document.createElement(type),
      dom.appendChild(args[0]);
      return dom;
    } else {
      dom = document.createElement(type),
      dom.innerHTML = args[0];
      return dom;
    }
  }

  dom = [];
  for (i = 0; i < length; i++) {
    if (typeof args[i] === 'undefined') {
    } else if (typeof args[i] === 'object') {
    } else {
      dom.push((el = document.createElement(type)));
      el.innerHTML = args[i];
    }
  }

  return dom;
}

/**
 * Append element(s) to another element
 *
 * @param {HTMLDomElement} dom Element to append element(s) to
 * @param {HTMLDomElement} ...child Elements to append to the given element
 */
function append(dom, child) {
  var args = Array.from(arguments);
  args.shift();
  var child;

  for (a in args) {
    child = args[a];
    if (typeof child === 'undefined') {
      continue;
    }
    if (child instanceof Array) {
      var i;
      for (i in child) {
        dom.appendChild(child[i]);
      }
    } else if (child instanceof Node) {
      dom.appendChild(child);
    } else {
      dom.appendChild(document.createTextNode(child));
    }
  }

  return dom;

}

function section(title, classes) {
  var el = createElement('section',
      createElement('h1', title));
  el.className = title.toLowerCase().replace(' ', '_');
  return el;
}

function article(object, renderer) {
  var dom = document.createElement('article');

  if (object.className) {
    dom.className = object.className;
  }

  renderer(object, dom);

  // Register with keywords if have keywords
  if (object.keywords) {
    //register
  }

  return dom;
}

function linkLabel(data, type) {
  var el = document.createElement(type),
      link;

  if (data.href) {
    link = el.appendChild(document.createElement('a'));
    link.setAttribute('target', '_blank');
    link.setAttribute('href', data.href);
    link.innerHTML = data.name + (data.grade ? ' (' + data.grade + ')': '');
  } else {
    el.innerHTML = data.name + (data.grade ? ' (' + data.grade + ')': '');
  }

  return el;
}

function position(data, obj) {
  var el, link;

  append(obj, date(data));

  if (data.title) {
    obj.appendChild(document.createElement('h1')).innerHTML = data.title;
  }
  
  if (data.company) {
    el = obj.appendChild(linkLabel(data.company, 'p'));
    el.className = 'company';
  }

  if (data.location) {
    link = el.appendChild(loc(data.location));
  }

  if (data.description) {
    append(obj, description(data.description))
  }

  if (data.technologies) {
    var technologies;
    if (data.technologies instanceof Array) {
      technologies = makeList(data.technologies, 'i');
    } else {
      technologies = data.technologies;
    }

    el = createElement('p', 'Technologies used: ' + technologies);
    el.className = 'technologies';
    append(obj, el);
  }
}

function makeList(list, tag) {
  var string = '',
      start = (tag ? '<' + tag + '>' : ''),
      end = (tag ? '</' + tag + '>' : '');

  if (list instanceof Array) {
    if (list.length > 1) {
      string = start + list.slice(0, -1).join(end + ', ' + start)
          + end + ' and ' + start + list[list.length-1] + end;
    } else if (list.length === 1) {
      string = start + data.techologies[0] + end;
    } else {
      string = '';
    }
  }

  return string;
}

function course(data, obj) {
  var el, link, d, courseType = 'h1';

  append(obj, date(data));

  if (data.certification) {
    if (data.certification instanceof Array) {
      for (d in data.certification) {
        obj.appendChild(linkLabel(data.certification[d], 'h1'));
        }
    } else {
      obj.appendChild(linkLabel(data.certification, 'h1'));
    }
    courseType = 'h2';
  }

  if (data.course) {
    if (data.course instanceof Array) {
      for (d in data.course) {
        obj.appendChild(linkLabel(data.course[d], courseType));
        }
    } else {
      obj.appendChild(linkLabel(data.course, courseType));
    }
  }

  if (data.school) {
    if (data.school instanceof Array) {
      el = obj.appendChild(createElement('p'));
      for (d in data.school) {
        el.appendChild(linkLabel(data.school[d], 'span'));
        }
    } else {
      el =obj.appendChild(linkLabel(data.school, 'p'));
    }
    el.className = 'school';
  }
  
  if (data.location) {
    link = el.appendChild(loc(data.location));
  }

  el = obj.appendChild(document.createElement('div'));
  el.className = 'dateRange';
  append(obj, description(data.description))
}

function memberships(data, obj) {
  var el, link;

  append(obj, date(data));

  obj.appendChild(linkLabel(data.organisation, 'h1'));
  
  if (data.memberType) {
    el = obj.appendChild(linkLabel(data.memberType, 'p'));
    el.className = 'memberType';
  }

  append(obj, description(data.description))
}

function loc(data) {
  if (data.name) {
    el = createElement('p', data.name);
  } else {
  }
  el.className = 'location';
  return el;
}

var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

function makeDate(date) {
  var dom = createElement('date');
  if (typeof date === 'string') {
    append(dom, date);
  } else {
    append(dom,
        (date.month ? months[date.month-1] : undefined),
        ' ', date.year);
  }
  return dom;
}

function date(data) {
  var dom;

  if (data.date) {
    return makeDate(data.date);
  } else if (data.startDate || data.endDate) {
    dom = createElement('p');

    if (data.startDate && data.endDate) {
      append(dom, makeDate(data.startDate), ' - ', makeDate(data.endDate));
    } else if (data.startDate) {
      append(dom, makeDate(data.startDate), ' - now');
    } else if (data.endDate) {
      return makeDate(data.endDate);
    }

    dom.className = 'date';
    return dom;
  }
}

function description(data) {
  var d, el, dom;
  if (data instanceof Array) {
    if (data.length) {
      dom = createElement('ul');
      for (d in data) {
        if (typeof data[d] === 'string') {
          el = append(dom, createElement('li', data[d]));
        } else if (data[d] instanceof Array) {
          append(dom, createElement('li', createElement('ul', description(data[d]))));
        } else if (data[d] instanceof Object && data[d].name) {
          el = append(dom, linkLabel(data[d], 'li'));
          if (data[d].description) {
            append(el, description(data[d].description));
          }
        }
      }
    }
  } else if (data instanceof Object) {
    if (data.elements) {
      // If data.type is set, create a div and then an type element for each element
      if (data.type) {
        dom = createElement('div');
      } else {
        dom = createElement('p');
      }
      for (d in data.elements) {
        if (typeof data.elements[d] === 'undefined') {
        } else if (typeof data.elements[d] === 'object') {
          append(dom, description(data.elements[d]));
        } else {
          if (data.type) {
            append(dom, createElement(data.type, data.elements[d]));
          } else {
            append(dom, document.createTextNode(data.elements[d]));
          }
        }
      }
    }
  } else if (typeof data === 'undefined') {
    return;
  } else {
    return createElement('p', data);
  }

  return dom;
}

function list(data, renderer) {
  var d, doms = [];

  for (d in data) {
    doms.push(article(data[d], renderer));
  }

  return doms;
}

main = document.querySelector('body > main');
current = main;

append(main,
    append(section('Personal Profile'), createElement('p', resume.profile || resume.summary.join(' ')),
        resume.favouredTech && createElement('p', 'Favoured technologies: ' + makeList(resume.favouredTech, 'i'))),
    append(section('Employment'), list(resume.positions, position)),
    append(section('Professional Development'), list(resume.education, course)),
    append(section('Professional Memberships'), list(resume.memberships, memberships)),
    append(section('Interests'), description(resume.interests)));

// Set up search
search = document.querySelector('body > header > input');
activateSearch(main, search, {
  hideNodes: ['SECTION', 'ARTICLE']
});
