/**
 * Resume
 *
 * Copyright Jack Farley 2016
 */
var resume = {
  "summary": [
    "I am a technology engineer with software in the brain looking to apply my skills to the fields of data collection and presentation, environmental research and conservation.",
    "During my previous experiences, I have contributed both ideas, and 1s and 0s to a diverse range of projects, developing software for a range of platforms, from web applications to microcontrollers. I enjoy understanding systems down to the I/O level, developing logical solutions to problems and seeing the solutions through to completion.",
    "I want to advanced our understanding of the environment, by using and sharing my knowledge in technology and software development, to help explore and present new science."
  ],
  "profile": "A computer engineer with software in the brain and 8+ years experience in developing web applications. Specialises in developing elegant, responsive web applications for data-rich environments. Looking to contribute towards the advancement of science at Elsevier.",
  "positions": [
    {
      "company": {
        "id": 10077470,
        "name": "NHS Wales Informatics Service",
        "href": "http://www.wales.nhs.uk/nwis/"
      },
      "id": 747076814,
      "isCurrent": true,
      "location": {
        "country": {
          "code": "gb",
          "name": "United Kingdom"
        },
        "name": "Cardiff, United Kingdom"
      },
      "startDate": {
        "month": 12,
        "year": 2015
      },
      "description": [
        "Improving the efficiency of secondary healthcare in Wales by developing electronic forms using Orbeon Forms (XForms, XSLT, XML), HTML, CSS and Javascript.",
        "Ensuring the systems being developed are well documented",
        "Advocating the use of the Git versioning system and TFS",
        "Leading efficient agile development by designing for code reuse and simple design"
      ],
      "title": "Senior Software Developer"
    },
    {
      "company": {
        "name": "New Zealand Government",
        "href": "https://www.govt.nz/"
      },
      "endDate": {
        "month": 4,
        "year": 2014
      },
      "id": 729440249,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "month": 9,
        "year": 2010
      },
      "description": [
        "Improved the capability of teams by researching and developing complex computer systems to meet stringent requirements and specifications",
        "Increased the efficiency and resilience to services by developing programs and scripts in Perl, Bash and C to process data and monitor processing systems",
        "Designed, documented and implemented Linux-heavy networks",
        "Decreased time to deployment times designing and implementing automated Linux OS building and virtualisation using kernel virtual machine (KVM)",
        "Increased the security of internal computer networks using operating system hardening and, network and firewall design.",
        "Knowledge expert on a number of data processing systems and virtual machine infrastructure.",
        "Mentored and taught colleagues on computer systems and the Linux OS.",
        "Purchased required hardware through internal procurement system dealing directly with suppliers."
      ],
      "title": "Computer Systems Engineer"
    },
    {
      "company": {
        "name": "New Zealand Government",
        "href": "https://www.govt.nz/"
      },
      "endDate": {
        "month": 9,
        "year": 2010
      },
      "id": 729438306,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "month": 1,
        "year": 2010
      },
      "description": [
        "Administered three computer networks of around 50 computers total, which included workstations and high availability servers.",
        "Managed network and virtual infrastructures.",
        "Implemented network monitoring through Nagios, SAN storage, Puppet configuration management and server viritualisation using VMware ESX and vSphere.",
        "Designed a Perl-based web interface for managing customer job requests."
      ],
      "title": "Computer Systems Administrator"
    },
    {
      "company": {
        "name": "New Zealand Government",
        "href": "https://www.govt.nz/"
      },
      "endDate": {
        "month": 1,
        "year": 2010
      },
      "id": 734997919,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "month": 7,
        "year": 2008
      },
      "description": [
        "Designed scripts in Perl and C for automated processing of data."
      ],
      "title": "Software Developer"
    },
    {
      "company": {
        "name": "Solarhomes"
      },
      "endDate": {
        "month": 6,
        "year": 2008
      },
      "id": 712630753,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "month": 12,
        "year": 2007
      },
      "description": [
        "Designed automated home ventilation systems.",
        "Reverse-engineered and programmed Microchip PIC based automation controllers, and programmed Omron PLC controllers."
      ],
      "title": "Design Engineer"
    },
    {
      "company": {
        "name": "Meld Computer Engineering",
        "href": "https://www.meldce.com"
      },
      "endDate": {
        "year": 2008
      },
      "id": 380174126,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "year": 2004
      },
      "description": [
        "Designed and developed web applications using HTML, CSS, Javascript, PHP, MySQL and Actionscript for multiple clients.",
        "Interacted with customers during entire development life cycle."
      ],
      "title": "Web Application Engineer Contractor"
    },
    {
      "company": {
        "id": 77529,
        "industry": "Telecommunications",
        "name": "Tait Communications",
        "size": "501-1000",
        "type": "Privately Held",
        "href": "https://www.taitradio.com/"
      },
      "endDate": {
        "month": 2,
        "year": 2007
      },
      "id": 712632746,
      "isCurrent": false,
      "location": {
        "name": "Christchurch, New Zealand"
      },
      "startDate": {
        "month": 11,
        "year": 2006
      },
      "description": [
        "Developed a radio log analyser and web-interface using Python and SQLite to detect and investigate inconsistencies in radio products."
      ],
      "title": "Junior Design Engineer (Summer Internship)"
    },
    {
      "company": {
        "name": "BrowserCRM"
      },
      "endDate": {
        "month": 2,
        "year": 2006
      },
      "id": 712635239,
      "isCurrent": false,
      "location": {
        "name": "Wellington, New Zealand"
      },
      "startDate": {
        "month": 11,
        "year": 2005
      },
      "description": [
        "Developed client-side (Javascript, CSS and HTML) and server-side (PHP and MySQL) parts of the BrowserCRM interface"
      ],
      "title": "Developer"
    }
  ],
  "education": [
    {
      "className": "noprint",
      "course": {
        "name": "Meetup",
        "href": "hthttp://www.meetup.com/members/195339544/"
      },
      "school": [
        {
          "name": "UX Playground",
          "href": "http://www.meetup.com/UX-Playground-The-User-Experience-Meetup-for-Londoners/"
        },
        {
          "name": "BCS South Wales",
          "href": "http://www.meetup.com/BCS-South-Wales/"
        },
        {
          "name": "Test and QA Wales",
          "href": "http://www.meetup.com/Cardiff-Software-Testers-Meetup/"
        },
        /*{
          "name": "",
          "href": ""
        },*/
      ],
      "startDate": {
        "month": 11,
        "year": 2015
      }
    },
    {
      "school": {
        "name": "MongoDB University",
        "href": "https://university.mongodb.com"
      },
      "course": [
        {
          "name": "MongoDB for Node.js Developers",
          "code": "M101JS",
          "href": "https://university.mongodb.com/courses/M101JS/about"
        },
        {
          "name": "MongoDB for DBAs",
          "code": "M102",
          "href": "https://university.mongodb.com/courses/M102/about"
        }
      ],
      "date": {
        "month": 2,
        "year": 2015
      },
      "keywords": ["MongoDB", "NoSQL", "Javascript", "Database Administration"]
    },
    {
      "className": "noprint",
      "school": {
        "name": "Wellington Institute of Technology",
        "href": "http://www.weltec.ac.nz"
      },
      "location": {
        "name": "Wellington, NZ",
        "city": "Wellington",
        "country": "nz"
      },
      "date": {
        "month": 4,
        "year": 2014
      },
      "course": {
        "name": "Electrical Trade Revision Course",
        "href": "https://www.weltec.ac.nz/SUBJECTAREAS/EngineeringTrades/ElectricalTradeRevisionCourse/tabid/442/Default.aspx"
      },
      "certification": {
        "name": "Electrical Workers Registration Board (EWRB) Electrical Engineer Registration",
        "href": "http://www.ewrb.govt.nz/training-and-qualifications/requirements-by-class/electrical-engineers/"
      },
      "keywords": ["Electrical Engineer", "Electronics", "Electrical"]
    },
    {
      "school": {
        "name": "Auldhouse",
        "href": "http://www.auldhouse.co.nz"
      },
      "location": {
        "name": "Wellington, NZ"
      },
      "date": {
        "month": 11,
        "year": 2009
      },
      "certification": {
        "name": "Redhat Enterprise Linux (RHEL) Certified Engineer"
      }
    },
    {
      "school": {
        "name": "University of Canterybury",
        "href": "http://www.canterbury.ac.nz"
      },
      "location": {
        "name": "Christchurch, NZ",
        "city": "Christchurch",
        "country": "nz"
      },
      "certification": {
        "name": "Bachelor of Engineering with Honours",
        "specialisation": "Electrical and Electronic Engineering"
      },
      "startDate": {
        "month": 2,
        "year": 2004
      },
      "endDate": {
        "month": 11,
        "year": 2007
      },
      "description": {
        "elements": [
          "Specialising in:",
          [
            "Computer Hardware",
            "Computer Software",
            "Communications",
            "Electronic Materials & Device Engineering",
            "Engineering Management"
          ]
        ]
      }
    },
    {
      "className": "noprint",
      "school": {
        "name": "Onslow College",
        "href": "http://www.onslow.school.nz"
      },
      "location": {
        "name": "Wellington, NZ",
        "city": "Wellington",
        "country": "nz"
      },
      "certification": [
        {
          "name": "Bursary",
          "grade": "A Bursary",
          "href": "http://www.nzqa.govt.nz/qualifications-standards/results-2/secondary-school-qualifications-prior-to-2002/"
        },
        {
          "name": "Sixth Form Certificate",
          "grade": "University Entrance",
          "href": "http://www.nzqa.govt.nz/qualifications-standards/results-2/secondary-school-qualifications-prior-to-2002/"
        },
        {
          "name": "Electroics Technology Level 2",
        }
      ],
      "startDate": {
        "month": 2,
        "year": 1999
      },
      "endDate": {
        "month": 11,
        "year": 2003
      }
    }
  ],
  "memberships": [
    {
      "organisation": {
        "name": "Institute of Electrical and Electronic Engineers (IEEE)",
        "href": "http://www.ieee.org"
      },
      "startDate": {
        "year": 2004
      }
    },
    {
      "organisation": {
        "name": "Institute of Engineering and Technology (IET)",
        "href": "http://www.iet.org"
      },
      "startDate": {
        "year": 2004
      }
    }
  ],
  "interests": [
    'Technology',
    'Computers',
    {
      "name": "Podcasts",
      "description": [
        {
          "name": "Software Engineering Daily",
          "href": "http://softwareengineeringdaily.com/category/podcast/",
        },
        {
          "name": "The Web Ahead",
          "href": "http://www.thewebahead.net",
        },
        {
          "name": "Coding Blocks",
          "href": "http://www.codingblocks.net",
        }
      ]
    },
    'Hiking',
    'Scuba Diving',
    'The Outdoors'
  ]
};

var main;
var search;
var sections = [];
var current;

function createElement(type) {
  if (typeof type === 'undefined') {
    type = 'p';
  } else if (typeof type !== 'string') {
    throw new Error('type must be a string');
  }

  var dom, el;

  var args = Array.from(arguments);
  args.shift();
  var length = args.length;

  if (!length) {
    return document.createElement(type);
  } else if (length === 1) {
    if (args[0] instanceof Array) {
      args = args[0];
      length = args.length;
    } else if (args[0] instanceof HTMLElement) {
      dom = document.createElement(type),
      dom.appendChild(args[0]);
      return dom;
    } else {
      dom = document.createElement(type),
      dom.innerHTML = args[0];
      return dom;
    }
  }

  dom = [];
  for (i = 0; i < length; i++) {
    if (typeof args[i] === 'undefined') {
    } else if (typeof args[i] === 'object') {
    } else {
      dom.push((el = document.createElement(type)));
      el.innerHTML = args[i];
    }
  }

  return dom;
}

function append(dom, child) {
  var args = Array.from(arguments);
  args.shift();
  var child;

  for (a in args) {
    child = args[a];
    if (typeof child === 'undefined') {
      continue;
    }
    if (child instanceof Array) {
      var i;
      for (i in child) {
        dom.appendChild(child[i]);
      }
    } else if (child instanceof Node) {
      dom.appendChild(child);
    } else {
      dom.appendChild(document.createTextNode(child));
    }
  }

  return dom;

}

function section(title) {
  var el = createElement('section',
      createElement('h1', title));
  el.className = title.toLowerCase();
  return el;
}

function article(object, renderer) {
  var dom = document.createElement('article');

  if (object.className) {
    dom.className = object.className;
  }

  renderer(object, dom);

  // Register with keywords if have keywords
  if (object.keywords) {
    //register
  }

  return dom;
}

function linkLabel(data, type) {
  var el = document.createElement(type),
      link;

  if (data.href) {
    link = el.appendChild(document.createElement('a'));
    link.setAttribute('target', '_blank');
    link.setAttribute('href', data.href);
    link.innerHTML = data.name + (data.grade ? ' (' + data.grade + ')': '');
  } else {
    el.innerHTML = data.name + (data.grade ? ' (' + data.grade + ')': '');
  }

  return el;
}

function position(data, obj) {
  var el, link;

  append(obj, date(data));

  obj.appendChild(document.createElement('h1')).innerHTML = data.title;
  
  el = obj.appendChild(linkLabel(data.company, 'p'));
  el.className = 'company';
  
  if (data.location) {
    link = el.appendChild(loc(data.location));
  }

  el = obj.appendChild(document.createElement('div'));
  el.className = 'dateRange';
  append(obj, description(data.description))
}

function course(data, obj) {
  var el, link, d, courseType = 'h1';

  append(obj, date(data));

  if (data.certification) {
    if (data.certification instanceof Array) {
      for (d in data.certification) {
        obj.appendChild(linkLabel(data.certification[d], 'h1'));
        }
    } else {
      obj.appendChild(linkLabel(data.certification, 'h1'));
    }
    courseType = 'h2';
  }

  if (data.course) {
    if (data.course instanceof Array) {
      for (d in data.course) {
        obj.appendChild(linkLabel(data.course[d], courseType));
        }
    } else {
      obj.appendChild(linkLabel(data.course, courseType));
    }
  }

  if (data.school) {
    if (data.school instanceof Array) {
      el = obj.appendChild(createElement('p'));
      for (d in data.school) {
        el.appendChild(linkLabel(data.school[d], 'span'));
        }
    } else {
      el =obj.appendChild(linkLabel(data.school, 'p'));
    }
    el.className = 'school';
  }
  
  if (data.location) {
    link = el.appendChild(loc(data.location));
  }

  el = obj.appendChild(document.createElement('div'));
  el.className = 'dateRange';
  append(obj, description(data.description))
}

function memberships(data, obj) {
  var el, link;

  append(obj, date(data));

  obj.appendChild(linkLabel(data.organisation, 'h1'));
  
  if (data.memberType) {
    el = obj.appendChild(linkLabel(data.memberType, 'p'));
    el.className = 'memberType';
  }

  append(obj, description(data.description))
}

function loc(data) {
  if (data.name) {
    el = createElement('p', data.name);
  } else {
  }
  el.className = 'location';
  return el;
}

var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

function makeDate(date) {
  var dom = createElement('date');
  if (typeof date === 'string') {
    append(dom, date);
  } else {
    append(dom,
        (date.month ? months[date.month-1] : undefined),
        ' ', date.year);
  }
  return dom;
}

function date(data) {
  var dom;

  if (data.date) {
    return makeDate(data.date);
  } else if (data.startDate || data.endDate) {
    dom = createElement('p');

    if (data.startDate && data.endDate) {
      append(dom, makeDate(data.startDate), ' - ', makeDate(data.endDate));
    } else if (data.startDate) {
      append(dom, makeDate(data.startDate), ' - now');
    } else if (data.endDate) {
      return makeDate(data.endDate);
    }

    dom.className = 'date';
    return dom;
  }
}

function description(data) {
  var d, el, dom;
  if (data instanceof Array) {
    if (data.length) {
      dom = createElement('ul');
      for (d in data) {
        if (typeof data[d] === 'string') {
          el = append(dom, createElement('li', data[d]));
        } else if (data[d] instanceof Array) {
          append(dom, createElement('li', createElement('ul', description(data[d]))));
        } else if (data[d] instanceof Object && data[d].name) {
          el = append(dom, linkLabel(data[d], 'li'));
          if (data[d].description) {
            append(el, description(data[d].description));
          }
        }
      }
    }
  } else if (data instanceof Object) {
    if (data.elements) {
      if (data.type) {
        dom = createElement(data.type);
      } else {
        dom = createElement('p');
      }
      for (d in data.elements) {
        if (typeof data.elements[d] === 'undefined') {
        } else if (typeof data.elements[d] === 'object') {
          append(dom, description(data.elements[d]));
        } else {
          append(dom, document.createTextNode(data.elements[d]));
        }
      }
    }
  } else if (typeof data === 'undefined') {
    return;
  } else {
    return createElement('p', data);
  }

  return dom;
}

function list(data, renderer) {
  var d, doms = [];

  for (d in data) {
    doms.push(article(data[d], renderer));
  }

  return doms;
}

main = document.querySelector('body > main');
current = main;

append(main,
    append(section('Personal Profile'), createElement('p', resume.profile)),
    append(section('Employment'), list(resume.positions, position)),
    append(section('Professional Development'), list(resume.education, course)),
    append(section('Professional Memberships'), list(resume.memberships, memberships)),
    append(section('Interests'), description(resume.interests)));

// Set up search
search = document.querySelector('body > header > input');
activateSearch(main, search, {
  hideNodes: ['SECTION', 'ARTICLE']
});
